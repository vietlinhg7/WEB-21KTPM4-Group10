<body style=" margin-top: 60px;">

  <div id="map" style="height: 100%; width: 50%;" class="float-start"></div>

  <form action="addLocation" method="post" class="form float-end" style="height: 50%; width: 50%;">
    <div class="container py-3">
      <div class="card">
        <div class="card-header text-center">
          <h1>

          </h1>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col align-self-center">
              <img
                src="https://cdnphoto.dantri.com.vn/vdDPWOVB1hcODVeyES8rD1GTLio=/zoom/1200_630/2019/04/23/truong-dh-khoa-hoc-tu-nhien-tphcm-1555986970839.jpg"
                alt="" class="img-thumbnail" id="image">
              <label for="file-upload">file input</label>
              <input type="file" class="form-control-file" onclick="ChangeImage()" id="file-upload" />
            </div>
            <div class="col-md-5">
              <h4 class="card-header"><i class="bi bi-geo-alt-fill"></i><strong> Thông tin địa
                  điểm</strong> </h4>

              <div class="mb-3">
                <input type="text" class="form-control my-3" name="address" id="address" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="{{location.name}}" required>
              </div>


              <div class="mb-3">
                <input type="text" class="form-control" name="address_detail" id="address_detail" aria-describedby="helpId"
                  placeholder="Địa chỉ" value="{{location.diachi}}" required>
              </div>
              <h4 class="card-header"><i class="bi bi-geo-alt-fill mb-3"></i><strong> Khu vực</strong></h4>
              {{!-- Phường --}}
              {{!-- <div class="mb-3">
                <input type="text" class="form-control my-3" name="keyword" id="adress" aria-describedby="helpId"
                  placeholder="Phường" value="Phường {{location.phuongID}}" required>
              </div> --}}

              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <button id="quan"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Quận
                </button>
                <input type="hidden" id="QIDD" name="QIDD" value="">

                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each quan}}
                  <li><a class="dropdown-item overflow-hidden text-truncate" id="selectQ{{quanID}}"
                      onclick="selectOption('quan','Quận {{quanID}}')">Quận
                      {{quanID}}</a></li>
                  {{/each}}
                  </li>
                </ul>
              </div>

              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <button id="phuong"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Phường
                </button>
                <input type="hidden" id="PIDD" name="PIDD" value="">

                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each phuong}}
                  <li><a class="dropdown-item overflow-hidden text-truncate" href="#" id="selectP{{phuongID}}"
                      onclick="selectOption('phuong','Phường {{phuongID}}')">{{phuongID}}</a></li>
                  {{/each}}
                </ul>
              </div>

              {{!-- Quận --}}
              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Loại vị trí</strong></h4>
              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <button id="lvt"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-sm-auto w-100 overflow-hidden text-truncate"
                  type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Loại vị trí
                </button>
                <input type="hidden" id="LVT" name="LVT" value="">

                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each loaivitri}}
                  <li><a id="selectLVT{{name}}" class="dropdown-item overflow-hidden text-truncate" href="#"
                      onclick="selectOption('lvt','{{name}}')">{{name}}</a></li>
                  {{/each}}
                </ul>
              </div>




              {{!-- <div class="mb-3">
                <input type="text" class="form-control my-3" name="keyword" id="adress_type" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="{{location.hinhthuc}}" required>
              </div> --}}
              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Hình thức quảng cáo</strong>
              </h4>
              <div class="mb-3 hinh-thuc-quang-cao-dropdown d-flex position-relative">
                <button id="htqc"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  Hình thức quảng cáo
                </button>
                <input type="hidden" id="HTQC" name="HTQC" value="">

                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each hinhThuc}}
                  <li><a id="selectHTQC{{hinhthuc}}" class="dropdown-item" href="#"
                      onclick="selectOption('htqc','{{hinhthuc}}')">{{hinhthuc}}</a></li>
                  {{/each}}

                </ul>
              </div>


              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Quy Hoạch</strong></h4>

              <div class="mb-3 quy-hoach-dropdown d-flex position-relative">
                <button id="qh" class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100"
                  type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Quy hoạch
                </button>
                <input type="hidden" id="QHCQH" name="QHCQH" value="">
                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  <li><a name="QH" class="dropdown-item" href="#" onclick="selectOption('qh', 'Đã quy hoạch')">Đã quy
                      hoạch</a></li>
                  <li><a name="CQH" class="dropdown-item" href="#" onclick="selectOption('qh', 'Chưa quy hoạch')">Chưa
                      quy
                      hoạch</a></li>
                </ul>
              </div>

              <h4 class="card-header"><i class="bi bi-geo-alt-fill"></i><strong> Vị trí</strong> </h4>

              <div class="mb-3">
                <input type="text" class="form-control my-3" name="lat" id="lat" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="" required>
              </div>


              <div class="mb-3">
                <input type="text" class="form-control" name="lng" id="lng" aria-describedby="helpId"
                  placeholder="Địa chỉ" value="" required>
              </div>


              <div class="d-flex justify-content-end mt-3">
                <input class="btn btn-primary" type="submit" onclick="save()" value="Save">
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <script>
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5paKst7kP-INwPaSuqoak2nRGeJOSTQc&callback=initMap"
    async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script>
    function toggleLockScreen() {
      document.body.classList.toggle('locked');
    }
    function selectOption(buttonID, selectedText) {
      let button = document.getElementById(buttonID);
      button.innerHTML = selectedText;
      if (button.id == 'qh')
        document.getElementById('QHCQH').value = selectedText;
      if (button.id == 'htqc')
        document.getElementById('HTQC').value = selectedText;
      if (button.id == 'lvt')
        document.getElementById('LVT').value = selectedText;
      if (button.id == 'phuong')
        document.getElementById('PIDD').value = selectedText;
      if (button.id == 'quan')
        document.getElementById('QIDD').value = selectedText;
      //
      //document.getElementById('HTQC').value = selectedText;
      // document.getElementById('LVT').value = selectedText;
      //document.getElementById('PIDD').value = selectedText;
      // document.getElementById('QIDD').value = selectedText;


    }
    let lat;
    let lng;
    function createSubmitButton(map) {
      const controlButton = document.createElement("button");

      // Set CSS for the control.
      controlButton.style.backgroundColor = "#fff";
      controlButton.style.border = "2px solid #fff";
      controlButton.style.borderRadius = "3px";
      controlButton.style.boxShadow = "0 2px 6px rgba(0,0,0,.3)";
      controlButton.style.color = "rgb(25,25,25)";
      controlButton.style.cursor = "pointer";
      controlButton.style.fontFamily = "Roboto,Arial,sans-serif";
      controlButton.style.fontSize = "16px";
      controlButton.style.lineHeight = "38px";
      controlButton.style.margin = "8px 0 22px";
      controlButton.style.padding = "0 5px";
      controlButton.style.textAlign = "center";
      controlButton.textContent = "Save Location";
      controlButton.title = "Click to save location";
      controlButton.type = "button";

      // Setup the click event listeners: save the latitude and longitude.
      controlButton.addEventListener("click", () => {
        if (lat && lng) {
          localStorage.setItem('savedLat', lat);
          localStorage.setItem('savedLng', lng);
          updateLocationDisplay();
        } else {
          alert('Please click on the map to select a location');
        }
      });

      return controlButton;
    }

    function updateLocationDisplay() {
      const lat = localStorage.getItem('savedLat');
      const lng = localStorage.getItem('savedLng');

      // Update the display

      document.getElementById('lat').value = localStorage.getItem('savedLat');
      document.getElementById('lng').value = localStorage.getItem('savedLng');
    }

    function initMap() {
      const myLatlng = { lat: 10.7628356, lng: 106.6824824 };
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: myLatlng
      });

      let infoWindow = new google.maps.InfoWindow({
        content: 'Click the map to get the coordinates!',
        position: myLatlng
      });

      infoWindow.open(map);

      // Zoom to the location
      map.setCenter(myLatlng);
      map.setZoom(18);

      map.addListener('click', (mapsMouseEvent) => {
        infoWindow.close();
        infoWindow = new google.maps.InfoWindow({
          position: mapsMouseEvent.latLng
        });

        // Save the latitude and longitude to variables
        lat = mapsMouseEvent.latLng.lat();
        lng = mapsMouseEvent.latLng.lng();

        // Now you can use the lat and lng variables

        infoWindow.setContent(
          JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
        );
        infoWindow.open(map);
      });

      // Create the DIV to hold the control.
      const submitButtonDiv = document.createElement("div");
      // Create the control.
      const submitButton = createSubmitButton(map);
      // Append the control to the DIV.
      submitButtonDiv.appendChild(submitButton);
      map.controls[google.maps.ControlPosition.TOP_CENTER].push(submitButtonDiv);
    }

  </script>


</body>