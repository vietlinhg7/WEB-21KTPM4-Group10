<body>

  <div id="map" style="height: 100%; width: 50%;" class="float-start"></div>

  <form action="#" method="post" class="form float-end" style="height: 100%; width: 50%;">
      <div class="container py-3" style="width: 100%">
        <div class="card">
          <div class="card-header text-center">
            <h1>

            </h1>
          </div>
          <div class="card-body">
          <div class="row">
            <div class="col align-self-center d-flex flex-column align-items-start"  style="width: 50%;">
              <img
                  src={{location.hinhanh}}
                  alt="" 
                  class="img-thumbnail" 
                  id="image"
                  style="max-height: 50%; max-width: 100%; height: auto; width: auto;">
              <input type="file" class="form-control-file" onclick="ChangeImage()" id="file-upload" disabled/>
            </div>
            <div class="col-md-5" style="width: 50%;">
              <div class="mb-3">
                <input type="text" class="form-control my-3" name="toadoX" id="lat" aria-describedby="helpId"
                  placeholder="Tọa độ x" value="{{location.toadoX}}" required hidden>
              </div>
              <div class="mb-3">
                <input type="text" class="form-control my-3" name="toadoY" id="lng" aria-describedby="helpId"
                  placeholder="Tọa độ y" value="{{location.toadoY}}" required hidden>
              </div>
              <h4 class="card-header"><i class="bi bi-geo-alt-fill"></i><strong> Thông tin địa
                  điểm</strong> </h4>
              <div class="mb-3">
                <input type="text" class="form-control my-3" name="ten" id="adress" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="{{location.name}}" required readonly>
              </div>


              <div class="mb-3">
                <input type="text" class="form-control" name="diachi" id="adress_detail" aria-describedby="helpId"
                  placeholder="Địa chỉ" value="{{location.diachi}}" required readonly>
              </div>
              <h4 class="card-header"><i class="bi bi-geo-alt-fill mb-3"></i><strong> Khu vực</strong></h4>
              {{!-- Phường --}}
              {{!-- <div class="mb-3">
                <input type="text" class="form-control my-3" name="keyword" id="adress" aria-describedby="helpId"
                  placeholder="Phường" value="Phường {{location.phuongID}}" required>
              </div> --}}

              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <div class="mb-3">
                  <input type="text" class="form-control" name="quan" id="adress_detail" aria-describedby="helpId"
      placeholder="Quận" value="Quận {{location.quanID}}" style="width: 100%" required readonly>
                </div>
              </div>

              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <div class="mb-3">
                  <input type="text" class="form-control" name="phuong" id="adress_detail" aria-describedby="helpId"
      placeholder="Phường" value="Phường {{location.phuongID}}" style="width: 100%" required readonly>
                </div>
              </div>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
              {{!-- Quận --}}
              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Loại vị trí</strong></h4>
              <div class="mb-3 loai-vi-tri-dropdown d-flex position-relative">
                <button id="lvt"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-sm-auto w-100 overflow-hidden text-truncate" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false" disabled>
                  {{location.loaivitri}}
                </button>

                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each loaivitri}}
                  <li><a id="selectLVT{{name}}" class="dropdown-item overflow-hidden text-truncate" href="#" onclick="selectOption('lvt','{{name}}')">{{name}}</a></li>
                  {{/each}}
                </ul>
              </div>




              {{!-- <div class="mb-3">
                <input type="text" class="form-control my-3" name="keyword" id="adress_type" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="{{location.hinhthuc}}" required>
              </div> --}}
              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Hình thức quảng cáo</strong>
              </h4>
              <div class="mb-3 hinh-thuc-quang-cao-dropdown d-flex position-relative">
                <button id="htqc"
                  class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100 overflow-hidden text-truncate" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false" disabled>
                  {{location.hinhthuc}}
                </button>
                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  {{#each hinhThuc}}
                  <li><a id="selectHTQC{{hinhthuc}}" class="dropdown-item overflow-hidden text-truncate" href="#" onclick="selectOption('htqc','{{hinhthuc}}')">{{hinhthuc}}</a></li>
                  {{/each}}

                </ul>
              </div>


              <h4 class="card-header"><i class="bi bi-info-square"></i><strong> Quy Hoạch</strong></h4>

              {{!-- <div class="mb-3">
                <input type="text" class="form-control my-3" name="keyword" id="adress_type" aria-describedby="helpId"
                  placeholder="Tên địa điểm" value="{{location.quyhoach}}" required>
              </div> --}}

              <div class="mb-3 quy-hoach-dropdown d-flex position-relative">
                <button id="qh" class="btn btn-secondary btn-sm btn-light border border-secondary dropdown-toggle w-100"
                  type="button" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                  {{location.quyhoach}}
                </button>
                <ul class="dropdown-menu w-100 position-absolute start-0 dropdown-menu-bottom">
                  <li><a id="QH" class="dropdown-item" href="#" onclick="selectOption('qh', 'Đã quy hoạch')">Đã quy
                      hoạch</a></li>
                  <li><a id="CQH" class="dropdown-item" href="#" onclick="selectOption('qh', 'Chưa quy hoạch')">Chưa quy
                      hoạch</a></li>
                </ul>
              </div>
              <div class="d-flex justify-content-end mt-3">
                <input class="btn btn-success mx-3" type="button" id="editButton" onclick="edit()" value="Edit">
                <form action="/locationInfo" method="post">
                  <input class="btn btn-primary" type="submit" id="saveButton" value="Save" disabled>
                </form>
              </div>
              <input type="hidden" id="loaivitri" name="loaivitri">
              <input type="hidden" id="hinhthuc" name="hinhthuc">
              <input type="hidden" id="quyhoach" name="quyhoach">
              <input type="hidden" id="hinhanh" name="hinhanh" value={{location.hinhanh}}>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <script>
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC5paKst7kP-INwPaSuqoak2nRGeJOSTQc&callback=initMap"
    async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script>
    let editEnabled = false;
    function ChangeImage() {
    var inputFile = document.getElementById('file-upload');
    var file = inputFile.files[0];
    var reader = new FileReader();

    reader.onload = function(e) {
      var imgElement = document.getElementById('image');
      imgElement.src = e.target.result;
    }

    reader.readAsDataURL(file);
    }
    function toggleLockScreen() {
      document.body.classList.toggle('locked');
    }
    function selectOption(buttonID, selectedText) {
      let button = document.getElementById(buttonID);
      button.innerHTML = selectedText;
      let lvt = document.getElementById('lvt');
      let htqc = document.getElementById('htqc');
      let qh = document.getElementById('qh');
      document.getElementById('loaivitri').value = lvt.innerText;
      document.getElementById('hinhthuc').value = htqc.innerText;
      document.getElementById('quyhoach').value = qh.innerText;
    }
    let lat;
    let lng;
    function createSubmitButton(map) {
      const controlButton = document.createElement("button");

      // Set CSS for the control.
      controlButton.style.backgroundColor = "#fff";
      controlButton.style.border = "2px solid #fff";
      controlButton.style.borderRadius = "3px";
      controlButton.style.boxShadow = "0 2px 6px rgba(0,0,0,.3)";
      controlButton.style.color = "rgb(25,25,25)";
      controlButton.style.cursor = "pointer";
      controlButton.style.fontFamily = "Roboto,Arial,sans-serif";
      controlButton.style.fontSize = "16px";
      controlButton.style.lineHeight = "38px";
      controlButton.style.margin = "8px 0 22px";
      controlButton.style.padding = "0 5px";
      controlButton.style.textAlign = "center";
      controlButton.textContent = "Save Location";
      controlButton.title = "Click to save location";
      controlButton.type = "button";

      // Setup the click event listeners: save the latitude and longitude.
      controlButton.addEventListener("click", () => {
        if (lat && lng) {
          localStorage.setItem('savedLat', lat);
          localStorage.setItem('savedLng', lng);
          updateLocationDisplay();
        } else {
          alert('Please click on the map to select a location');
        }
      });

      return controlButton;
    }

    function updateLocationDisplay() {
      const lat = localStorage.getItem('savedLat');
      const lng = localStorage.getItem('savedLng');

      // Update the display
      document.getElementById('lat').value = localStorage.getItem('savedLat');
      document.getElementById('lng').value = localStorage.getItem('savedLng');

    }

    function initMap() {
      const myLatlng = { lat: 10.7628356, lng: 106.6824824 };
      const map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: myLatlng
      });

      let infoWindow = new google.maps.InfoWindow({
        content: 'Click the map to get the coordinates!',
        position: myLatlng
      });

      infoWindow.open(map);

      // Zoom to the location
      map.setCenter(myLatlng);
      map.setZoom(18);

      map.addListener('click', (mapsMouseEvent) => {
          if (editEnabled) {
          infoWindow.close();
          infoWindow = new google.maps.InfoWindow({
            position: mapsMouseEvent.latLng
          });

          // Save the latitude and longitude to variables
          lat = mapsMouseEvent.latLng.lat();
          lng = mapsMouseEvent.latLng.lng();

          // Now you can use the lat and lng variables

          infoWindow.setContent(
            JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          infoWindow.open(map);
        }
      });

      // Create the DIV to hold the control.
      const submitButtonDiv = document.createElement("div");
      // Create the control.
      const submitButton = createSubmitButton(map);
      // Append the control to the DIV.
      submitButtonDiv.appendChild(submitButton);
      map.controls[google.maps.ControlPosition.TOP_CENTER].push(submitButtonDiv);
    }
    function edit() {
      // Enable editing
      document.getElementById('file-upload').removeAttribute('disabled');
      
      // Select all input fields except those with IDs "phuong" and "quan"
      let readonlyInputs = document.querySelectorAll('input:not([placeholder="Phường"]):not([placeholder="Quận"])');

      
      // Remove the 'readonly' attribute from these input fields
      readonlyInputs.forEach((input) => {
        input.removeAttribute('readonly');
      });

      let disableddropdown = document.querySelectorAll('.btn-secondary');
      disableddropdown.forEach((button) => {
        button.removeAttribute('disabled');
      });
      editEnabled = true;
      document.getElementById('editButton').setAttribute('disabled', 'true');
      document.getElementById('saveButton').removeAttribute('disabled');
      let lvt = document.getElementById('lvt');
      let htqc = document.getElementById('htqc');
      let qh = document.getElementById('qh');
      document.getElementById('loaivitri').value = lvt.innerText;
      document.getElementById('hinhthuc').value = htqc.innerText;
      document.getElementById('quyhoach').value = qh.innerText;
    }
  </script>


</body>
